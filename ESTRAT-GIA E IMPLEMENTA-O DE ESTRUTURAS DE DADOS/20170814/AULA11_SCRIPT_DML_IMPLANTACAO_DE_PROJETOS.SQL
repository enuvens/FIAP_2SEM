-- SCRIPT DML -LING.MANIPULAÇÃO DE DADOS
-- INSERT, UPDATE,DELETE

-- POPULAR AS TABELAS (INSERT)
INSERT INTO T_SIP_DEPARTAMENTO
            (CD_DEPTO,NM_DEPTO)
     VALUES (1, 'FINANCEIRO');

INSERT INTO T_SIP_DEPARTAMENTO VALUES (2,'VENDAS');

-- PROVOCAR ERRO DE UNIQUE CONSTRAINT- JÁ EXISTE O DEPTO = VENDAS
INSERT INTO T_SIP_DEPARTAMENTO VALUES (3,'VENDAS');
-- O CONTEÚDO DO BANCO É CASE SENSITIVE
INSERT INTO T_SIP_DEPARTAMENTO VALUES (3,'vendas');

INSERT INTO T_SIP_DEPARTAMENTO VALUES (4,'COMPRAS');
INSERT INTO T_SIP_DEPARTAMENTO VALUES (5,'TECNOLOGIA DA INFORMAÇÃO');

SELECT * FROM T_SIP_DEPARTAMENTO;

-- POPULAR A TABELA FUNCIONARIO
INSERT INTO T_SIP_FUNCIONARIO
            (NR_MATRICULA ,CD_DEPTO, 
             NM_FUNCIONARIO, 
             DT_NASCIMENTO, 
             DT_ADMISSAO,
             VL_SALARIO
            )
     VALUES (12345, 1,
             'JOÃO DA SILVA',
             TO_DATE('10/05/1985','DD/MM/YYYY') ,
             TO_DATE('05/08/2010','DD/MM/YYYY') ,
             5871.63 -- SEMPRE USAR PONTO DECIMAL
            );

INSERT INTO T_SIP_FUNCIONARIO
            (NR_MATRICULA ,CD_DEPTO, 
             NM_FUNCIONARIO, 
             DT_NASCIMENTO, 
             DT_ADMISSAO,
             VL_SALARIO
            )
     VALUES (12346, 1,
             'MARIA CAROLINA',
             NULL , -- ENVIO DE NULO PARA CAMPO OPCIONAL
             TO_DATE('15/09/2012','DD/MM/YYYY') ,
             3687.55 -- SEMPRE USAR PONTO DECIMAL
            );

-- PROVOCAR ERRO,NÃO INFORMAR NULO OU VALOR PARA COLUNA
-- OPCIONAL DECLARADA NA INSTRUÇÃO
INSERT INTO T_SIP_FUNCIONARIO
            (NR_MATRICULA ,CD_DEPTO, 
             NM_FUNCIONARIO, 
             DT_NASCIMENTO, 
             DT_ADMISSAO,
             VL_SALARIO
            )
     VALUES (12347, 1,
             'TESTE',
             
             TO_DATE('15/09/2012','DD/MM/YYYY') ,
             1500.32 
            );
-- OMITINDO A COLUNA DATA DE NASCIMENTO (SO E POSSIVEL COM
-- CAMPOS OPCIONAIS
INSERT INTO T_SIP_FUNCIONARIO
            (NR_MATRICULA ,CD_DEPTO, 
             NM_FUNCIONARIO,              
             DT_ADMISSAO,
             VL_SALARIO
            )
     VALUES (12347, 2,
             'MANOEL TEIXEIRA',             
             TO_DATE('28/03/2013','DD/MM/YYYY') ,
             1750.32 
            );

-- ERRO DE VIOLAÇÃO DA CHAVE ESTRANGEIRA
INSERT INTO T_SIP_FUNCIONARIO
            (NR_MATRICULA ,CD_DEPTO, 
             NM_FUNCIONARIO,              
             DT_ADMISSAO,
             VL_SALARIO
            )
     VALUES (12348, 7, -- NÃO EXISTE DEPTO = 7 -> VIOLAÇÃO DE FK
             'TESTE',             
             TO_DATE('28/03/2013','DD/MM/YYYY') ,
             1000.32 
            );

SELECT * FROM T_SIP_FUNCIONARIO;

-- ALTERAR O FORMATO DA DATA/HORA DA SESSÃO ABERTA
ALTER SESSION SET NLS_DATE_FORMAT = 'dd/mm/yyyy hh24:mi:ss';
ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY HH:MI';
ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY';

-- CRIAR A TABELA ABAIXO,TEMPORARIAMENTE
CREATE TABLE T_SIP_DEPARTAMENTO_TEMP
(
  cd_depto    NUMBER(2)     NOT NULL ,
  nm_depto    VARCHAR2(30)  NOT NULL
);
-- CONTRAINTS (REGRAS OU RESTRIÇÕES)
-- CHAVE PRIMÁRIA
    ALTER TABLE T_SIP_DEPARTAMENTO_TEMP
 ADD CONSTRAINT PK_SIP_DEPTO_TEMP
    PRIMARY KEY (cd_depto); 

-- INSERT A PARTIR DE UMA SUBCONSULTA
INSERT INTO T_SIP_DEPARTAMENTO_TEMP
	 (cd_depto, nm_depto) 
 (SELECT cd_depto, nm_depto FROM T_SIP_DEPARTAMENTO);

SELECT * FROM T_SIP_DEPARTAMENTO_TEMP;

-- COMANDO UPDATE: ALTERA O CONTEÚDO DAS COLUNAS
-- AFETANDO UMA OU MAIS LINHAS/REGISTROS
UPDATE T_SIP_DEPARTAMENTO
   SET NM_DEPTO = 'CONTAS A PAGAR'
 WHERE CD_DEPTO = 3;   

SELECT * FROM T_SIP_DEPARTAMENTO;

-- ALTERAÇÃO SEM APLICAR CONDIÇÕA --- ATENÇÃO:JUSTA CAUSA
UPDATE T_SIP_DEPARTAMENTO_TEMP
   SET NM_DEPTO = 'CONTAS A PAGAR';

SELECT * FROM T_SIP_DEPARTAMENTO_TEMP;   

-- UPDATE COM DUAS COLUNAS ATUALIZADAS
UPDATE T_SIP_FUNCIONARIO
   SET NM_FUNCIONARIO = 'MARIA CAROLINA DAS DORES' ,
       DT_NASCIMENTO = TO_DATE('10/03/1987','DD/MM/YYYY')
 WHERE NR_MATRICULA=12346;
 
-- UPDATE A PARTIR DE UM CÁLCULO
-- OS FUNCIONARIOS DO DEPTO DE COD=1,RECEBERÃO 10% DE AUMENTO
UPDATE T_SIP_FUNCIONARIO
   SET VL_SALARIO = VL_SALARIO * 1.10
 WHERE CD_DEPTO = 1;

-- UPDATE - EXEMPLO COM SUBCONSULTA 
UPDATE T_SIP_FUNCIONARIO
   SET CD_DEPTO = 
       (SELECT CD_DEPTO FROM T_SIP_FUNCIONARIO 
         WHERE NR_MATRICULA = 12347)
 WHERE NR_MATRICULA = 12346;         

-- UPDATE UTILIZANDO OPERADOR LÓGICO NA CLAUSULA WHERE
UPDATE T_SIP_FUNCIONARIO
   SET VL_SALARIO =VL_SALARIO * 1.05
 WHERE CD_DEPTO = 2 AND VL_SALARIO <= 2000;

SELECT * FROM T_SIP_FUNCIONARIO;

-- DELETE -> PRECISA DA CLAUSULA WHERE
-- DELETE SEM WHERE - JUSTA CAUSA -- APAGA TODAS AS LINHAS DA TABELA
-- DELETE NA TABELA TEMPORARIA
DELETE FROM T_SIP_DEPARTAMENTO_TEMP;
SELECT * FROM T_SIP_DEPARTAMENTO_TEMP;
-- EXEMPLOS COM WHERE
DELETE FROM T_SIP_DEPARTAMENTO
      WHERE CD_DEPTO=5;

-- EXEMPLO DE DELEÇÃO QUE VIOLA A FK
-- TENTATIVA DE DELEÇÃO DE UM DEPTO QUE POSSUI
-- FUNCIONARIOS ASSOCIADOS A ELE
DELETE FROM T_SIP_DEPARTAMENTO
      WHERE CD_DEPTO= 2;
      
SELECT * FROM T_SIP_DEPARTAMENTO;      

-- DELETE COM SUBCONSULTA
DELETE FROM T_SIP_FUNCIONARIO
      WHERE CD_DEPTO = (SELECT CD_DEPTO 
                          FROM T_SIP_DEPARTAMENTO
                         WHERE NM_DEPTO = 'FINANCEIRO');

SELECT * FROM T_SIP_DEPARTAMENTO; 
SELECT * FROM T_SIP_FUNCIONARIO;     
COMMIT;

     